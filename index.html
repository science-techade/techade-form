<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Опросный лист по техпроцессу</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        // Инициализация EmailJS с вашим публичным ключом.
        // Замените 'YOUR_PUBLIC_KEY' на ваш фактический Public Key из EmailJS.
        // Вы можете найти его в разделе "Account" -> "API Keys" в вашей учетной записи EmailJS.
        (function() {
            emailjs.init({
                publicKey: "2p7l9sK9Zfj6c2SXi" // <-- ВАШ ПУБЛИЧНЫЙ КЛЮЧ EmailJS ЗДЕСЬ!
            });
        })();
    </script>
    <style>
        /* Общие стили для динамически добавляемых строк элементов */
        .element-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .element-row input {
            flex: 1;
        }
        .element-row button {
            white-space: nowrap;
        }
        /* Стили для секций анализатора, которые показываются/скрываются */
        .analyzer-section, .conditional-block {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        /* Стили для обязательных полей */
        .required-field::after {
            content: " *";
            color: red;
        }
        /* Стили для контейнера, который используется для генерации PDF (СКРЫТ ДЛЯ ПРОДАКШНА) */
        .pdf-render-container {
            position: fixed;
            top: -9999px; /* Скрываем за пределами экрана */
            left: -9999px;
            width: 210mm; /* Ширина A4 */
            min-height: 297mm; /* Минимальная высота A4 */
            padding: 20mm; /* Отступы для содержимого PDF */
            box-sizing: border-box;
            background: white;
            z-index: -1000; /* За всеми остальными элементами */
            overflow: hidden; /* Скрываем скроллбары */
            opacity: 0; /* Делаем полностью невидимой */
            pointer-events: none; /* Гарантируем отсутствие взаимодействия */
        }

        /* Стили для статических блоков в PDF */
        .pdf-field-display {
            margin-bottom: 4px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: #f9f9f9;
            font-size: 13px;
        }
        .pdf-h5 {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.25rem;
            font-weight: 500;
        }
        .pdf-section-title {
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .pdf-sub-section-title {
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 1.1rem;
            font-weight: 500;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="mb-4">Опросный лист по техпроцессу</h2>
    <form id="form">
        <div id="pdf-content">
            <div class="mb-4">
                <h5>Основные сведения</h5>
                <div class="mb-3">
                    <label for="date" class="form-label required-field">Дата заполнения опросного листа</label>
                    <input type="date" id="date" name="date" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="company" class="form-label required-field">Название компании</label>
                    <input type="text" id="company" name="company" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="contact_person" class="form-label">Контактное лицо</label>
                    <input type="text" id="contact_person" name="contact_person" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="phone" class="form-label">Телефон</label>
                    <input type="tel" id="phone" name="phone" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label required-field">Email</label>
                    <input type="email" id="email" name="email" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="country" class="form-label">Страна</label>
                    <input type="text" id="country" name="country" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="location" class="form-label">Местонахождение</label>
                    <input type="text" id="location" name="location" class="form-control">
                </div>
            </div>

            <div class="mb-3">
                <label for="material" class="form-label required-field">Тип анализируемого материала</label>
                <select id="material" name="material" class="form-select" required>
                    <option value="">Выберите...</option>
                    <option value="pulp">Пульпа (1–3 потока для анализа)</option>
                    <option value="sinter">Шихта / руда</option>
                    <option value="multiplex">Пульпа с мультиплексором</option>
                    <option value="courier">Пульпа с мультиплексором (на замену анализатора Курьер)</option>
                </select>
            </div>

            <div id="section-pulp" class="analyzer-section">
                <h5>Пульпа: оборудование</h5>
                <div class="mb-3">
                    <label class="form-label">Количество точек для анализа</label>
                    <input type="number" name="pulp_streams" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Характеристика подачи питания</label>
                    <select name="pulp_feed_type" id="feed_type" class="form-select">
                        <option value="">Выберите...</option>
                        <option value="naporny">Напорный</option>
                        <option value="samotek">Самотек</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Диаметр</label>
                    <input type="text" name="pulp_diameter" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Материал (нерж. сталь, резиновая футеровка и т.д.)</label>
                    <input type="text" name="pulp_material_type" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Давление нагнетания / Угол разгрузки</label>
                    <input type="text" name="pulp_pressure_angle" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Температура окружающей среды (мин/макс)</label>
                    <input type="text" name="pulp_temperature" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Анализируемые элементы от Ca до U + диапазон концентраций</h5>
                    <div id="elements-ca-u"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('elements-ca-u')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <h5>Анализ легких химических элементов</h5>
                    <div id="light-elements"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('light-elements')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <label class="form-label">Плотность</label>
                    <input type="text" name="pulp_density" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Время измерения (мин/сред/макс), сек</label>
                    <input type="text" name="pulp_measurement_time" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Наличие тяжёлых металлов в пульпе</label>
                    <input type="text" name="pulp_heavy_metals" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Состав жидкой фазы</label>
                    <input type="text" name="pulp_liquid_phase" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Перечень используемых реагентов</label>
                    <input type="text" name="pulp_reagents" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Дополнительные условия</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="xrf_lab_pulp" name="xrf_lab_pulp">
                        <label class="form-check-label" for="xrf_lab_pulp">Наличие РФА-лаборатории на предприятии</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="personnel_access_pulp" name="personnel_access_pulp">
                        <label class="form-check-label" for="personnel_access_pulp">Допуск персонала к источникам</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="local_network_pulp" name="local_network_pulp">
                        <label class="form-check-label" for="local_network_pulp">Наличие локальной сети</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="installation_location_pulp">Местонахождение установки</label>
                        <input type="text" class="form-control mb-2" id="installation_location_pulp" name="installation_location_pulp">

                        <label class="form-label" for="installation_photo_pulp">Загрузите фото местонахождения (JPG, PNG)</label>
                        <input type="file" class="form-control mb-2" id="installation_photo_pulp" name="installation_photo_pulp" accept=".jpg,.jpeg,.png,image/jpeg,image/png">

                        <img id="installation_preview_pulp" alt="Превью изображения" style="max-width: 100%; height: auto; display: none; border: 1px solid #ccc; margin-top: 10px;" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="water_composition_pulp">Состав оборотной воды</label>
                        <input type="text" class="form-control" id="water_composition_pulp" name="water_composition_pulp">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video_surveillance_pulp" name="video_surveillance_pulp">
                        <label class="form-check-label" for="video_surveillance_pulp">Наличие видеонаблюдения</label>
                    </div>
                </div>
            </div>

            <div id="section-sinter" class="analyzer-section">
                <h5>Шихта / руда: оборудование</h5>
                <div class="mb-3">
                    <label class="form-label">Рассматриваются анализаторы</label>
                    <select name="sinter_analyzer_type" class="form-select">
                        <option value="">Выберите...</option>
                        <option value="arp-1c">АРП-1Ц</option>
                        <option value="arp-2c">АРП-2Ц</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Скорость ленты (м/с)</label>
                    <input type="text" name="sinter_belt_speed" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Нагрузка на ленте (тонн/час, мин/макс)</label>
                    <input type="text" name="sinter_belt_load" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Анализируемые элементы от Ca до U + диапазон концентраций</h5>
                    <div id="sinter-elements-ca-u"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('sinter-elements-ca-u')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <label class="form-label">Размер кусков (макс/сред), мм</label>
                    <input type="text" name="sinter_grain_size" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Плотность</label>
                    <input type="text" name="sinter_density" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Время измерения (мин/сред/макс), сек</label>
                    <input type="text" name="sinter_measurement_time" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Наличие тяжёлых металлов в шихте</label>
                    <input type="text" name="sinter_heavy_metals" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Дополнительные условия</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="xrf_lab_sinter" name="xrf_lab_sinter">
                        <label class="form-check-label" for="xrf_lab_sinter">Наличие РФА-лаборатории на предприятии</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="personnel_access_sinter" name="personnel_access_sinter">
                        <label class="form-check-label" for="personnel_access_sinter">Допуск персонала к источникам</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="local_network_sinter" name="local_network_sinter">
                        <label class="form-check-label" for="local_network_sinter">Наличие локальной сети</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="installation_location_sinter">Местонахождение установки</label>
                        <input type="text" class="form-control mb-2" id="installation_location_sinter" name="installation_location_sinter">

                        <label class="form-label" for="installation_photo_sinter">Загрузите фото местонахождения (JPG, PNG)</label>
                        <input type="file" class="form-control mb-2" id="installation_photo_sinter" name="installation_photo_sinter" accept=".jpg,.jpeg,.png,image/jpeg,image/png">

                        <img id="installation_preview_sinter" alt="Превью изображения" style="max-width: 100%; height: auto; display: none; border: 1px solid #ccc; margin-top: 10px;" />
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video_surveillance_sinter" name="video_surveillance_sinter">
                        <label class="form-check-label" for="video_surveillance_sinter">Наличие видеонаблюдения</label>
                    </div>
                </div>
            </div>

            <div id="section-multiplex" class="analyzer-section">
                <h5>Пульпа с мультиплексором</h5>
                <div class="mb-3">
                    <label class="form-label">Количество точек для анализа</label>
                    <input type="number" name="multiplex_streams" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Расстояния между точками</label>
                    <input type="text" name="multiplex_distances" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Тип трубы и её характеристики (диаметр)</label>
                    <input type="text" name="multiplex_pipe_type" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Давление в трубопроводе</label>
                    <input type="text" name="multiplex_pressure" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Температура окружающей среды (мин/макс)</label>
                    <input type="text" name="multiplex_temperature" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Анализируемые элементы от Ca до U + диапазон концентраций</h5>
                    <div id="multiplex-elements-ca-u"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('multiplex-elements-ca-u')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <h5>Анализ легких химических элементов</h5>
                    <div id="multiplex-light-elements"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('multiplex-light-elements')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <label class="form-label">Размер кусков (макс/сред), мм</label>
                    <input type="text" name="multiplex_grain_size" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Плотность</label>
                    <input type="text" name="multiplex_density" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Время измерения (мин/сред/макс), сек</label>
                    <input type="text" name="multiplex_measurement_time" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Наличие тяжёлых металлов</label>
                    <input type="text" name="multiplex_heavy_metals" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Состав жидкой фазы</label>
                    <input type="text" name="multiplex_liquid_phase" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Перечень используемых реагентов</label>
                    <input type="text" name="multiplex_reagents" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Дополнительные условия</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="xrf_lab_multiplex" name="xrf_lab_multiplex">
                        <label class="form-check-label" for="xrf_lab_multiplex">Наличие РФА-лаборатории на предприятии</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="personnel_access_multiplex" name="personnel_access_multiplex">
                        <label class="form-check-label" for="personnel_access_multiplex">Допуск персонала к источникам</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="local_network_multiplex" name="local_network_multiplex">
                        <label class="form-check-label" for="local_network_multiplex">Наличие локальной сети</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="installation_location_multiplex">Местонахождение установки</label>
                        <input type="text" class="form-control mb-2" id="installation_location_multiplex" name="installation_location_multiplex">

                        <label class="form-label" for="installation_photo_multiplex">Загрузите фото местонахождения (JPG, PNG)</label>
                        <input type="file" class="form-control mb-2" id="installation_photo_multiplex" name="installation_photo_multiplex" accept=".jpg,.jpeg,.png,image/jpeg,image/png">

                        <img id="installation_preview_multiplex" alt="Превью изображения" style="max-width: 100%; height: auto; display: none; border: 1px solid #ccc; margin-top: 10px;" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="water_composition_multiplex">Состав оборотной воды</label>
                        <input type="text" class="form-control" id="water_composition_multiplex" name="water_composition_multiplex">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video_surveillance_multiplex" name="video_surveillance_multiplex">
                        <label class="form-check-label" for="video_surveillance_multiplex">Наличие видеонаблюдения</label>
                    </div>
                </div>
            </div>

            <div id="section-courier" class="analyzer-section">
                <h5>Пульпа с мультиплексором (на замену Курьер)</h5>
                <div class="mb-3">
                    <label class="form-label">Наличие существующей системы отбора/доставки проб (Courier, MOG или иная)</label>
                    <input type="text" name="courier_existing_system" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Планируется ли подключение к существующему мультиплексору</label>
                    <input type="text" name="courier_connection_plan" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Количество точек для анализа</label>
                    <input type="number" name="courier_streams" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Температура окружающей среды (мин/макс)</label>
                    <input type="text" name="courier_temperature" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Анализируемые элементы от Ca до U + диапазон концентраций</h5>
                    <div id="courier-elements-ca-u"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('courier-elements-ca-u')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <h5>Анализ легких химических элементов</h5>
                    <div id="courier-light-elements"></div>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addElementRow('courier-light-elements')">+ Добавить элемент</button>
                </div>
                <div class="mb-3">
                    <label class="form-label">Плотность</label>
                    <input type="text" name="courier_density" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Время измерения (мин/сред/макс), сек</label>
                    <input type="text" name="courier_measurement_time" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Наличие тяжёлых металлов в пульпе</label>
                    <input type="text" name="courier_heavy_metals" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Состав жидкой фазы</label>
                    <input type="text" name="courier_liquid_phase" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Перечень используемых реагентов</label>
                    <input type="text" name="courier_reagents" class="form-control">
                </div>
                <div class="mb-3">
                    <h5>Дополнительные условия</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="xrf_lab_courier" name="xrf_lab_courier">
                        <label class="form-check-label" for="xrf_lab_courier">Наличие РФА-лаборатории на предприятии</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="personnel_access_courier" name="personnel_access_courier">
                        <label class="form-check-label" for="personnel_access_courier">Допуск персонала к источникам</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="local_network_courier" name="local_network_courier">
                        <label class="form-check-label" for="local_network_courier">Наличие локальной сети</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="installation_location_courier">Местонахождение установки</label>
                        <input type="text" class="form-control mb-2" id="installation_location_courier" name="installation_location_courier">

                        <label class="form-label" for="installation_photo_courier">Загрузите фото местонахождения (JPG, PNG)</label>
                        <input type="file" class="form-control mb-2" id="installation_photo_courier" name="installation_photo_courier" accept=".jpg,.jpeg,.png,image/jpeg,image/png">

                        <img id="installation_preview_courier" alt="Превью изображения" style="max-width: 100%; height: auto; display: none; border: 1px solid #ccc; margin-top: 10px;" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="water_composition_courier">Состав оборотной воды</label>
                        <input type="text" class="form-control" id="water_composition_courier" name="water_composition_courier">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video_surveillance_courier" name="video_surveillance_courier">
                        <label class="form-check-label" for="video_surveillance_courier">Наличие видеонаблюдения</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-3 mt-4">
            <div class="form-check attachment-checkbox">
                <input class="form-check-input" type="checkbox" id="sendPdf" checked>
                <label class="form-check-label" for="sendPdf">Отправить PDF вложение</label>
            </div>

            <button id="submit-button" type="button" class="btn btn-primary">Отправить</button>
        </div>
        <div class="mt-3">
            <small class="text-muted"><span style="color: red;">*</span> - обязательные поля</small>
        </div>
    </form>

    <iframe id="pdf-preview" style="width: 100%; height: 500px; margin-top: 20px; display: none;"></iframe>

    <div id="error-message" class="alert alert-danger mt-3" style="display: none;"></div>
    <div id="success-message" class="alert alert-success mt-3" style="display: none;"></div>

</div>

<script>
    // Идентификаторы EmailJS. Замените их на свои, полученные после настройки EmailJS.
    const EMAILJS_SERVICE_ID = 'service_1rnpxea'; // Ваш Service ID из EmailJS
    const EMAILJS_TEMPLATE_ID = 'template_sk137ts'; // Ваш Template ID из EmailJS (для вашей формы)
    // ВАЖНО: ЗАМЕНИТЕ ЭТОТ URL НА РАЗВЕРНУТЫЙ URL ВАШЕГО GOOGLE APPS SCRIPT!
    const GOOGLE_SHEET_MACRO_URL = 'https://script.google.com/macros/s/AKfycbzkOZ-Qo4-7_-ZYIL2IOm5qyIkK1YjNDoRK0cYvs0PUL3RPSILWAG3kYkYq6tkpu1vafg/exec';

    const dynamicElementData = {};

    function saveDynamicValues(containerId) {
        const data = [];
        document.querySelectorAll(`#${containerId} .element-row`).forEach(row => {
            const inputs = row.querySelectorAll("input");
            if (inputs.length >= 2) {
                data.push({
                    element: inputs[0].value || '',
                    range: inputs[1].value || ''
                });
            }
        });
        dynamicElementData[containerId] = data;
    }

    function restoreDynamicValues(containerId) {
        const container = document.getElementById(containerId);
        if (!dynamicElementData[containerId]) return;

        container.innerHTML = ""; // Очищаем, чтобы восстановить
        dynamicElementData[containerId].forEach(entry => {
            const wrapper = document.createElement("div");
            wrapper.className = "element-row";

            const inputElement = document.createElement("input");
            inputElement.type = "text";
            inputElement.placeholder = "Элемент (напр. Fe)";
            inputElement.name = `${containerId}_element[]`;
            inputElement.className = "form-control";
            inputElement.value = entry.element;
            inputElement.oninput = () => saveDynamicValues(containerId);

            const inputRange = document.createElement("input");
            inputRange.type = "text";
            inputRange.placeholder = "Диапазон концентрации";
            inputRange.name = `${containerId}_range[]`;
            inputRange.className = "form-control";
            inputRange.value = entry.range;
            inputRange.oninput = () => saveDynamicValues(containerId);

            const removeBtn = document.createElement("button");
            removeBtn.type = "button";
            removeBtn.className = "btn btn-outline-danger btn-sm";
            removeBtn.textContent = "Удалить";
            removeBtn.onclick = () => {
                wrapper.remove();
                saveDynamicValues(containerId);
            };

            wrapper.appendChild(inputElement);
            wrapper.appendChild(inputRange);
            wrapper.appendChild(removeBtn);
            container.appendChild(wrapper);

        });
    }

    const containers = Array.from(document.querySelectorAll("[id$='-elements-ca-u'], [id$='-light-elements']")).map(el => el.id);
    containers.forEach(containerId => {
        // Инициализируем данные для каждого контейнера
        dynamicElementData[containerId] = [];
        // Добавляем начальный элемент для каждого контейнера, если он пуст
        if (document.getElementById(containerId).children.length === 0) {
            addElementRow(containerId);
        }
    });

    function addElementRow(containerId) {
        const container = document.getElementById(containerId);
        const wrapper = document.createElement("div");
        wrapper.className = "element-row";

        const inputElement = document.createElement("input");
        inputElement.type = "text";
        inputElement.placeholder = "Элемент (напр. Fe)";
        inputElement.name = `${containerId}_element[]`;
        inputElement.className = "form-control";
        inputElement.oninput = () => saveDynamicValues(containerId);

        const inputRange = document.createElement("input");
        inputRange.type = "text";
        inputRange.placeholder = "Диапазон концентрации";
        inputRange.name = `${containerId}_range[]`;
        inputRange.className = "form-control";
        inputRange.oninput = () => saveDynamicValues(containerId);

        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.className = "btn btn-outline-danger btn-sm";
        removeBtn.textContent = "Удалить";
        removeBtn.onclick = () => {
            wrapper.remove();
            saveDynamicValues(containerId); // Обновляем данные после удаления
        };

        wrapper.appendChild(inputElement);
        wrapper.appendChild(inputRange);
        wrapper.appendChild(removeBtn);
        container.appendChild(wrapper);

        saveDynamicValues(containerId); // Сохраняем данные при добавлении новой строки
    }

    // Обработчик для отображения/скрытия секций анализатора
    document.getElementById('material').addEventListener('change', function() {
        document.querySelectorAll('.analyzer-section').forEach(section => {
            section.style.display = 'none';
        });
        const selectedValue = this.value;
        if (selectedValue) {
            const targetSection = document.getElementById(`section-${selectedValue}`);
            if (targetSection) {
                targetSection.style.display = 'block';
                // Восстанавливаем данные для активной секции
                containers.forEach(containerId => {
                    if (containerId.startsWith(selectedValue)) {
                        restoreDynamicValues(containerId);
                    }
                });
            }
        }
    });

    // Обработчики для предпросмотра изображений
    document.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', function() {
            const previewId = this.id.replace('installation_photo', 'installation_preview');
            const preview = document.getElementById(previewId);
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(this.files[0]);
            } else {
                preview.src = '';
                preview.style.display = 'none';
            }
        });
    });

    // --- Функции для генерации PDF ---
    function collectFormDataForPdf() {
        const formData = new FormData(document.getElementById('form'));
        const data = {};
        for (let [key, value] of formData.entries()) {
            // Обработка чекбоксов: FormData по умолчанию не включает unchecked чекбоксы
            if (document.querySelector(`input[name="${key}"][type="checkbox"]`) && !value) {
                data[key] = false; // Устанавливаем false для снятых чекбоксов
            } else {
                data[key] = value;
            }
        }

        // Добавление данных из динамических полей
        for (const containerId in dynamicElementData) {
            data[containerId] = dynamicElementData[containerId];
        }

        // Обработка чекбоксов, которые не включены в FormData
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            if (!formData.has(checkbox.name)) {
                data[checkbox.name] = checkbox.checked;
            }
        });

        return data;
    }

    async function generatePdfContent(data) {
        const pdfContentDiv = document.createElement('div');
        pdfContentDiv.className = 'pdf-render-container'; // Скрытый контейнер
        document.body.appendChild(pdfContentDiv);

        let html = '<h1 class="pdf-section-title">Опросный лист по техпроцессу</h1>';
        html += '<h2 class="pdf-h5">Основные сведения</h2>';
        html += `<div class="pdf-field-display"><strong>Дата заполнения:</strong> ${data.date || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Название компании:</strong> ${data.company || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Контактное лицо:</strong> ${data.contact_person || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Телефон:</strong> ${data.phone || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Email:</strong> ${data.email || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Страна:</strong> ${data.country || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Местонахождение:</strong> ${data.location || 'Не указано'}</div>`;
        html += `<div class="pdf-field-display"><strong>Тип анализируемого материала:</strong> ${document.getElementById('material').options[document.getElementById('material').selectedIndex].text || 'Не выбрано'}</div>`;

        const selectedMaterial = data.material;
        if (selectedMaterial) {
            html += `<h2 class="pdf-section-title">${document.getElementById('material').options[document.getElementById('material').selectedIndex].text}</h2>`;

            // Общие поля для всех анализаторов пульпы
            const materialPrefix = selectedMaterial; // pulp, multiplex, courier, sinter

            // Динамические элементы
            const elementsCaU = dynamicElementData[`${materialPrefix}-elements-ca-u`] || [];
            const lightElements = dynamicElementData[`${materialPrefix}-light-elements`] || [];

            if (elementsCaU.length > 0 && elementsCaU.some(e => e.element || e.range)) {
                html += `<h5 class="pdf-sub-section-title">Анализируемые элементы от Ca до U + диапазон концентраций</h5>`;
                elementsCaU.forEach(item => {
                    if (item.element || item.range) {
                        html += `<div class="pdf-field-display">${item.element} (Диапазон: ${item.range})</div>`;
                    }
                });
            }

            if (lightElements.length > 0 && lightElements.some(e => e.element || e.range)) {
                html += `<h5 class="pdf-sub-section-title">Анализ легких химических элементов</h5>`;
                lightElements.forEach(item => {
                    if (item.element || item.range) {
                        html += `<div class="pdf-field-display">${item.element} (Диапазон: ${item.range})</div>`;
                    }
                });
            }

            // Specific fields based on material type
            switch (selectedMaterial) {
                case 'pulp':
                    html += `<div class="pdf-field-display"><strong>Количество точек для анализа:</strong> ${data.pulp_streams || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Характеристика подачи питания:</strong> ${data.pulp_feed_type || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Диаметр:</strong> ${data.pulp_diameter || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Материал:</strong> ${data.pulp_material_type || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Давление нагнетания / Угол разгрузки:</strong> ${data.pulp_pressure_angle || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Температура окружающей среды:</strong> ${data.pulp_temperature || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Плотность:</strong> ${data.pulp_density || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Время измерения:</strong> ${data.pulp_measurement_time || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие тяжёлых металлов в пульпе:</strong> ${data.pulp_heavy_metals || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Состав жидкой фазы:</strong> ${data.pulp_liquid_phase || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Перечень используемых реагентов:</strong> ${data.pulp_reagents || 'Не указано'}</div>`;
                    html += `<h5 class="pdf-sub-section-title">Дополнительные условия</h5>`;
                    html += `<div class="pdf-field-display"><strong>Наличие РФА-лаборатории:</strong> ${data.xrf_lab_pulp ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Допуск персонала к источникам:</strong> ${data.personnel_access_pulp ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие локальной сети:</strong> ${data.local_network_pulp ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Местонахождение установки:</strong> ${data.installation_location_pulp || 'Не указано'}</div>`;
                    if (data.installation_photo_pulp_base64) {
                         html += `<img src="${data.installation_photo_pulp_base64}" style="max-width: 100%; height: auto; margin-top: 10px;">`;
                    }
                    html += `<div class="pdf-field-display"><strong>Состав оборотной воды:</strong> ${data.water_composition_pulp || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие видеонаблюдения:</strong> ${data.video_surveillance_pulp ? 'Да' : 'Нет'}</div>`;
                    break;
                case 'sinter':
                    html += `<div class="pdf-field-display"><strong>Рассматриваются анализаторы:</strong> ${data.sinter_analyzer_type || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Скорость ленты:</strong> ${data.sinter_belt_speed || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Нагрузка на ленте:</strong> ${data.sinter_belt_load || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Размер кусков:</strong> ${data.sinter_grain_size || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Плотность:</strong> ${data.sinter_density || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Время измерения:</strong> ${data.sinter_measurement_time || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие тяжёлых металлов в шихте:</strong> ${data.sinter_heavy_metals || 'Не указано'}</div>`;
                    html += `<h5 class="pdf-sub-section-title">Дополнительные условия</h5>`;
                    html += `<div class="pdf-field-display"><strong>Наличие РФА-лаборатории:</strong> ${data.xrf_lab_sinter ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Допуск персонала к источникам:</strong> ${data.personnel_access_sinter ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие локальной сети:</strong> ${data.local_network_sinter ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Местонахождение установки:</strong> ${data.installation_location_sinter || 'Не указано'}</div>`;
                    if (data.installation_photo_sinter_base64) {
                        html += `<img src="${data.installation_photo_sinter_base64}" style="max-width: 100%; height: auto; margin-top: 10px;">`;
                    }
                    html += `<div class="pdf-field-display"><strong>Наличие видеонаблюдения:</strong> ${data.video_surveillance_sinter ? 'Да' : 'Нет'}</div>`;
                    break;
                case 'multiplex':
                    html += `<div class="pdf-field-display"><strong>Количество точек для анализа:</strong> ${data.multiplex_streams || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Расстояния между точками:</strong> ${data.multiplex_distances || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Тип трубы и её характеристики:</strong> ${data.multiplex_pipe_type || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Давление в трубопроводе:</strong> ${data.multiplex_pressure || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Температура окружающей среды:</strong> ${data.multiplex_temperature || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Размер кусков:</strong> ${data.multiplex_grain_size || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Плотность:</strong> ${data.multiplex_density || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Время измерения:</strong> ${data.multiplex_measurement_time || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие тяжёлых металлов:</strong> ${data.multiplex_heavy_metals || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Состав жидкой фазы:</strong> ${data.multiplex_liquid_phase || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Перечень используемых реагентов:</strong> ${data.multiplex_reagents || 'Не указано'}</div>`;
                    html += `<h5 class="pdf-sub-section-title">Дополнительные условия</h5>`;
                    html += `<div class="pdf-field-display"><strong>Наличие РФА-лаборатории:</strong> ${data.xrf_lab_multiplex ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Допуск персонала к источникам:</strong> ${data.personnel_access_multiplex ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие локальной сети:</strong> ${data.local_network_multiplex ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Местонахождение установки:</strong> ${data.installation_location_multiplex || 'Не указано'}</div>`;
                    if (data.installation_photo_multiplex_base64) {
                        html += `<img src="${data.installation_photo_multiplex_base64}" style="max-width: 100%; height: auto; margin-top: 10px;">`;
                    }
                    html += `<div class="pdf-field-display"><strong>Состав оборотной воды:</strong> ${data.water_composition_multiplex || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие видеонаблюдения:</strong> ${data.video_surveillance_multiplex ? 'Да' : 'Нет'}</div>`;
                    break;
                case 'courier':
                    html += `<div class="pdf-field-display"><strong>Наличие существующей системы отбора/доставки проб:</strong> ${data.courier_existing_system || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Планируется ли подключение к существующему мультиплексору:</strong> ${data.courier_connection_plan || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Количество точек для анализа:</strong> ${data.courier_streams || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Температура окружающей среды:</strong> ${data.courier_temperature || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Плотность:</strong> ${data.courier_density || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Время измерения:</strong> ${data.courier_measurement_time || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие тяжёлых металлов в пульпе:</strong> ${data.courier_heavy_metals || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Состав жидкой фазы:</strong> ${data.courier_liquid_phase || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Перечень используемых реагентов:</strong> ${data.courier_reagents || 'Не указано'}</div>`;
                    html += `<h5 class="pdf-sub-section-title">Дополнительные условия</h5>`;
                    html += `<div class="pdf-field-display"><strong>Наличие РФА-лаборатории:</strong> ${data.xrf_lab_courier ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Допуск персонала к источникам:</strong> ${data.personnel_access_courier ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие локальной сети:</strong> ${data.local_network_courier ? 'Да' : 'Нет'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Местонахождение установки:</strong> ${data.installation_location_courier || 'Не указано'}</div>`;
                    if (data.installation_photo_courier_base64) {
                        html += `<img src="${data.installation_photo_courier_base64}" style="max-width: 100%; height: auto; margin-top: 10px;">`;
                    }
                    html += `<div class="pdf-field-display"><strong>Состав оборотной воды:</strong> ${data.water_composition_courier || 'Не указано'}</div>`;
                    html += `<div class="pdf-field-display"><strong>Наличие видеонаблюдения:</strong> ${data.video_surveillance_courier ? 'Да' : 'Нет'}</div>`;
                    break;
            }
        }
        pdfContentDiv.innerHTML = html;
        return pdfContentDiv;
    }

    async function submitForm() {
        const form = document.getElementById('form');
        const submitButton = document.getElementById('submit-button');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');

        errorMessage.style.display = 'none';
        successMessage.style.display = 'none';
        submitButton.disabled = true;

        if (!form.checkValidity()) {
            errorMessage.textContent = 'Пожалуйста, заполните все обязательные поля.';
            errorMessage.style.display = 'block';
            form.reportValidity(); // Показывает стандартные сообщения валидации
            submitButton.disabled = false;
            return;
        }

        let formData = collectFormDataForPdf(); // Собираем данные для отправки и PDF

        // Обработка изображений: чтение файлов и кодирование в Base64
        const imageInputs = [
            { id: 'installation_photo_pulp', name: 'installation_photo_pulp_base64' },
            { id: 'installation_photo_sinter', name: 'installation_photo_sinter_base64' },
            { id: 'installation_photo_multiplex', name: 'installation_photo_multiplex_base64' },
            { id: 'installation_photo_courier', name: 'installation_photo_courier_base64' }
        ];

        for (const imgInput of imageInputs) {
            const inputElement = document.getElementById(imgInput.id);
            if (inputElement && inputElement.files && inputElement.files[0]) {
                const file = inputElement.files[0];
                await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        formData[imgInput.name] = reader.result;
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        // Подготовка данных для Google Sheets
        const sheetData = {
            timestamp: new Date().toLocaleString(),
            date: formData.date,
            company: formData.company,
            contact_person: formData.contact_person,
            phone: formData.phone,
            email: formData.email,
            country: formData.country,
            location: formData.location,
            material_type: document.getElementById('material').options[document.getElementById('material').selectedIndex].text,
            // Добавляем все поля, специфичные для выбранного типа материала, и динамические элементы
            ...formData,
            // Удаляем сырые данные файлов, так как мы отправили их в base64
            installation_photo_pulp: undefined,
            installation_photo_sinter: undefined,
            installation_photo_multiplex: undefined,
            installation_photo_courier: undefined
        };

        // Специальная обработка динамических элементов для Google Sheets
        ['elements-ca-u', 'light-elements', 'sinter-elements-ca-u', 'multiplex-elements-ca-u', 'multiplex-light-elements', 'courier-elements-ca-u', 'courier-light-elements'].forEach(id => {
            if (sheetData[id]) {
                sheetData[id] = sheetData[id].map(item => `${item.element || ''} (${item.range || ''})`).filter(String).join('; ');
            }
        });

        let pdfBlob = null;
        if (document.getElementById('sendPdf').checked) {
            try {
                const pdfContentDiv = await generatePdfContent(formData); // Используем formData, чтобы PDF мог включать Base64 изображения
                const opt = {
                    margin: 10,
                    filename: 'Опросный_лист.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                const pdf = await html2pdf().from(pdfContentDiv).set(opt).outputPdf('bloburl');
                // Для EmailJS нужен Blob
                pdfBlob = await fetch(pdf).then(res => res.blob());
                document.body.removeChild(pdfContentDiv); // Удаляем скрытый контейнер после генерации
            } catch (error) {
                console.error("Ошибка при генерации PDF:", error);
                errorMessage.textContent = 'Ошибка при создании PDF. Пожалуйста, попробуйте еще раз.';
                errorMessage.style.display = 'block';
                submitButton.disabled = false;
                return;
            }
        }

        // Отправка данных в Google Таблицу через Google Apps Script
        try {
            const response = await fetch(GOOGLE_SHEET_MACRO_URL, {
                method: 'POST',
                mode: 'cors', // Важно для кросс-доменных запросов
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(sheetData)
            });

            if (!response.ok) {
                throw new Error(`Ошибка HTTP: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();
            if (result.status === 'success') {
                successMessage.textContent = 'Данные успешно отправлены в Google Таблицу!';
                successMessage.style.display = 'block';
                form.reset(); // Очистить форму после успешной отправки
                document.querySelectorAll('.analyzer-section').forEach(section => {
                    section.style.display = 'none'; // Скрыть все секции
                });
                document.querySelectorAll('img[id^="installation_preview"]').forEach(img => {
                    img.style.display = 'none';
                    img.src = '';
                });
                // Очищаем динамические данные
                for (const containerId in dynamicElementData) {
                    dynamicElementData[containerId] = [];
                    document.getElementById(containerId).innerHTML = '';
                    addElementRow(containerId); // Добавить пустую строку после сброса
                }
            } else {
                errorMessage.textContent = `Ошибка при записи данных в Google Таблицу: ${result.message || 'Неизвестная ошибка'}`;
                errorMessage.style.display = 'block';
            }
        } catch (error) {
            console.error('Ошибка при отправке данных в Google Таблицу:', error);
            errorMessage.textContent = `Ошибка при отправке данных в Google Таблицу: ${error.message}`;
            errorMessage.style.display = 'block';
        } finally {
            submitButton.disabled = false;
        }

        // Отправка EmailJS (не зависит от Google Sheets)
        if (pdfBlob) {
            const file = new File([pdfBlob], "Опросный_лист.pdf", { type: "application/pdf" });

            const templateParams = {
                // Все поля формы, которые вы хотите включить в EmailJS
                company: formData.company,
                email: formData.email,
                message: "См. прикрепленный опросный лист в формате PDF.",
                // ... другие поля, если нужны в шаблоне EmailJS
            };

            // Преобразование Blob в Base64 для EmailJS вложения
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = function() {
                templateParams.attachment = reader.result.split(',')[1]; // Base64 без префикса data:application/pdf;base64,
                templateParams.attachment_name = "Опросный_лист.pdf";

                emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
                    .then(function(response) {
                        console.log('EmailJS отправлен успешно!', response.status, response.text);
                    }, function(error) {
                        console.error('Ошибка при отправке EmailJS:', error);
                        // Опционально: показать сообщение об ошибке EmailJS, если оно критично
                    });
            };
        }
    }

    document.getElementById('submit-button').addEventListener('click', submitForm);

    // Инициализация формы при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        // Добавляем по одной пустой строке для каждого динамического раздела при загрузке
        containers.forEach(containerId => {
            addElementRow(containerId);
        });
    });

</script>
</body>
</html>
